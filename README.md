# Interview Bot

## Описание
Телеграм-бот для отработки собеседований. Построен на `aiogram 3`, хранит вопросы в SQLite и проверяет открытые ответы через OpenAI. Бот ведёт диалоги на русском, умеет требовать подписку на канал перед началом квиза и предоставляет администраторам инструменты для управления базой вопросов прямо из чата.

## Возможности
- выбор уровня сложности и темы квиза;
- смешанные тесты с вопросами multiple choice и открытыми ответами;
- автоматическая проверка открытых ответов через OpenAI (оценка 0–5 и комментарий);
- учёт сессий и статистика по пользователям, темам и ответам;
- загрузка/редактирование вопросов из JSON и через команды `/add_topic`, `/add_q`;
- проверка подписки на канал перед выдачей материалов.

## Требования
- Python 3.11+ (проверено на Windows, macOS и Linux);
- установленный `pip` (идёт в комплекте с Python);
- Telegram Bot API токен (получается у [BotFather](https://t.me/BotFather));
- OpenAI API key с доступом к выбранной модели (по умолчанию `gpt-4o-mini`);
- доступ в интернет для запросов к Telegram и OpenAI.

## Быстрый запуск
```bash
git clone https://github.com/<your-account>/new_interview_bot.git
cd new_interview_bot
python -m venv .venv
# Windows PowerShell:
.venv\Scripts\Activate.ps1
# macOS / Linux:
source .venv/bin/activate
pip install -r requirements.txt
# Скопируйте пример конфига и заполните переменные:
# Windows:
copy .env.example .env
# macOS / Linux:
cp .env.example .env
python main.py
```
После запуска в консоли появится сообщение `Bot is running...`. Пока окно терминала открыто, бот принимает апдейты.

## Переменные окружения (`.env`)
| Имя | Обязательно | Назначение |
|-----|-------------|------------|
| `TELEGRAM_BOT_TOKEN` | да | Токен бота из BotFather. Без него приложение не стартует. |
| `OPENAI_API_KEY` | да | Ключ OpenAI для проверки открытых ответов. |
| `OPENAI_MODEL` | нет | Идентификатор модели OpenAI (по умолчанию `gpt-4o-mini`). Можно заменить на совместимую. |
| `REQUIRED_CHANNEL` | нет | Ссылка или `@username` канала, подписка на который проверяется перед началом. Пустое значение отключит проверку. |
| `ADMINS` | нет | Список Telegram ID админов через запятую. Им доступны команды редактирования и статистики. |
| `DEFAULT_SESSION_N` | нет | Базовое количество вопросов, которое бот предлагает на старте сессии. |

Файл `.env` не коммитьте в репозиторий. После изменения переменных перезапустите бота.

## Данные и база вопросов
- При первом запуске создаётся база `bot_data.db` в корне проекта.
- Стартовые темы и вопросы берутся из `storage/seed_topics.json`. Измените файл и перезапустите бота, чтобы загрузить своё наполнение.
- Пример файла для импорта через `/import_q` лежит в `storage/import_sample.json`.
- Тестовые темы, перечисленные в `PLACEHOLDER_TOPIC_TITLES` (`storage/db.py`), автоматически удаляются при загрузке новых данных — используйте уникальные названия.

## Запуск и мониторинг
- Локально запускайте `python main.py` (или `py main.py` на Windows). Для фонового режима используйте менеджер процессов (`systemd`, `pm2`, `supervisor`, `screen` и т.д.).
- Логи пишутся в стандартный вывод с уровнем `INFO`. Информация об админ-командах также попадает в лог.
- При обновлении `.env` или базы данных перезапускайте процесс, чтобы изменения вступили в силу.

## Команды бота
**Пользовательские**
- `/start` — приветствие, описание возможностей и кнопка меню.
- `/menu` — повторно показать главное меню без приветствия.
- `/quiz` — выбрать уровень, тему и запустить квиз.
- `/help` — подсказка по основным функциям.

**Проверка подписки**
- Если `REQUIRED_CHANNEL` не пуст, бот проверяет подписку перед выдачей меню. Пользователю приходит кнопка со ссылкой на канал.

**Команды для администраторов** (для ID из `ADMINS`)
- `/import_q [append|replace]` — отправьте команду с JSON-файлом. `append` (значение по умолчанию) добавляет новые вопросы, `replace` перезатирает темы из файла. Формат файла — список объектов или объект с ключом `topics`.
- `/add_topic <basic|advanced> | <название>` — создать тему с указанным уровнем сложности.
- `/add_q <тема[@уровень]> | <mcq|open> | <текст> | <варианты или -> | <правильный или -> | <идеальный ответ или ->` — добавить вопрос. Для `mcq` варианты перечисляются через `;` или JSON-массив, правильный ответ — номер варианта (1…n). Для `open` вместо вариантов и номера используйте `-`, а в последний блок впишите пример идеального ответа.
- `/stats` — агрегированная статистика по пользователям, темам, вопросам и ответам.

## Полезные советы
- Получите Telegram ID администратора через @userinfobot и добавьте его в `ADMINS`.
- Ограничьте расходы OpenAI с помощью отдельного проекта и бюджета.
- Для чистой установки удалите `bot_data.db` перед запуском — база пересоздастся с актуальными данными из `seed_topics.json`.
